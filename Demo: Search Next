"""
The following code searches a text widget for all instances of a search term,
them scrolls down through each instance of that term all with a single button.
"""



from tkinter import *

root = Tk()
root.title("Search App")

text = Text(root, width=40, height=10, wrap=WORD)
text.pack(expand=YES, fill=BOTH)

search_entry = Entry(root)
search_entry.pack(side=LEFT, padx=5, pady=5)

def find_next():
    global search_positions
    global current_result_index

    search_text = search_entry.get()

    if search_text:
        start_pos = "1.0"
        if not search_positions:
            search_positions = []
            while True:
                pos = text.search(search_text, start_pos, stopindex="end")
                if not pos:
                    break
                end_pos = f"{pos}+{len(search_text)}c"
                text.tag_add("found", pos, end_pos)
                start_pos = end_pos
                search_positions.append(pos)
            text.tag_configure("found", background="yellow")
            current_result_index = -1
        if current_result_index < len(search_positions) - 1:
            current_result_index += 1
        else:
            current_result_index = 0
        next_result()

def find_previous():
    global search_positions
    global current_result_index

    search_text = search_entry.get()

    if search_text:
        end_pos = "end-1c"
        if not search_positions:
            search_positions = []
            while True:
                pos = text.search(search_text, end_pos, stopindex="1.0", backwards=True)
                if not pos:
                    break
                end_pos = pos
                text.tag_add("found", pos, f"{pos}+{len(search_text)}c")
                search_positions.insert(0, pos)
            text.tag_configure("found", background="yellow")
            current_result_index = len(search_positions)
        if current_result_index > 0:
            current_result_index -= 1
        else:
            current_result_index = len(search_positions) - 1
        next_result()

def next_result():
    global search_positions
    global current_result_index

    if search_positions:
        text.tag_remove("found", "1.0", "end")
        pos = search_positions[current_result_index]
        text.tag_add("found", pos, f"{pos}+{len(search_entry.get())}c")
        text.mark_set("insert", pos)
        text.see(pos)

search_button = Button(root, text="Find Next", command=find_next)
search_button.pack(side=LEFT, padx=5, pady=5)

search_button = Button(root, text="Find Prev", command=find_previous)
search_button.pack(side=LEFT, padx=5, pady=5)

search_positions = []
current_result_index = -1


# Test text for the purposes of debugging
text.insert("end", "one\ntwo\nthree\n")
text.insert("end", "four\n", ("bigfont",))
text.insert("end", "five\nsecond two\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n")
text.insert("end", "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nthree two")
text.insert("end", "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfour two")
text.insert("end", "\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nfive two")
text.tag_configure("bigfont", font=("Helvetica", "24", "bold")) 


root.mainloop()

