"""
A Simple set of Functions to act as a Search and Replace feature inside a Notebook app.
"""

from tkinter import *

def find_and_replace():
    dialog = Toplevel(root)
    dialog.title("Find and Replace")
    
    find_term = StringVar()
    replace_term = StringVar()
    match_case = IntVar()
    whole_words = IntVar()
    
    def find():
        find_text = find_term.get()
        if not find_text:
            return
        options = ''
        if match_case.get():
            options += 'd'
        if whole_words.get():
            options += 'w'
        text.tag_remove('found', '1.0', END)
        idx = '1.0'
        while 1:
            idx = text.search(find_text, idx, nocase=not match_case.get(), stopindex=END, count=options)
            if not idx:
                break
            lastidx = f"{idx}+{len(find_text)}c"
            text.tag_add('found', idx, lastidx)
            idx = lastidx
        text.tag_config('found', foreground='green', background='yellow')

    def find_all():
        find()
    
    def replace():
        find_text = find_term.get()
        replace_text = replace_term.get()
        if find_text and replace_text:
            options = ''
            if match_case.get():
                options += 'd'
            if whole_words.get():
                options += 'w'
            text_content = text.get('1.0', 'end-1c')
            updated_content = text_content.replace(find_text, replace_text)
            text.delete('1.0', 'end')
            text.insert('1.0', updated_content)
            find()
    
    def replace_all():
        find_text = find_term.get()
        replace_text = replace_term.get()
        if find_text and replace_text:
            options = ''
            if match_case.get():
                options += 'd'
            if whole_words.get():
                options += 'w'
            text_content = text.get('1.0', 'end-1c')
            updated_content = text_content.replace(find_text, replace_text)
            text.delete('1.0', 'end')
            text.insert('1.0', updated_content)
            find_all()
    
    Label(dialog, text="Find: ").grid(row=0, column=0, padx=5, pady=5, sticky=W)
    Entry(dialog, textvariable=find_term).grid(row=0, column=1, padx=5, pady=5)
    Button(dialog, text="Find", command=find, width=10).grid(row=0, column=2, padx=5, pady=5)
    Button(dialog, text="Find All", command=find_all, width=10).grid(row=0, column=3, padx=5, pady=5)
    
    Label(dialog, text="Replace: ").grid(row=1, column=0, padx=5, pady=5, sticky=W)
    Entry(dialog, textvariable=replace_term).grid(row=1, column=1, padx=5, pady=5)
    Button(dialog, text="Replace", command=replace, width=10).grid(row=1, column=2, padx=5, pady=5)
    Button(dialog, text="Replace All", command=replace_all, width=10).grid(row=1, column=3, padx=5, pady=5)
    
    Checkbutton(dialog, text="Match Case", variable=match_case).grid(row=2, column=0, columnspan=2, padx=5, pady=5, sticky=W)
    Checkbutton(dialog, text="Whole Words", variable=whole_words).grid(row=2, column=2, columnspan=2, padx=5, pady=5, sticky=W)
    
    find_term.set('')
    replace_term.set('')
    
    find_term_entry = find_term.get()
    replace_term_entry = replace_term.get()
    
    if match_case.get():
        options += 'd'
    if whole_words.get():
        options += 'w'
    
    if find_term_entry:
        find()
    
    find_term.trace("w", lambda name, index, mode: find())
    find_term.trace("w", lambda name, index, mode: find_all())
    find_term.trace("w", lambda name, index, mode: replace())
    find_term.trace("w", lambda name, index, mode: replace_all())

root = Tk()
text = Text(root)
text.insert('1.0', '''Type your text here''')
text.pack(side=BOTTOM)

menu_bar = Menu(root)
root.config(menu=menu_bar)
submenu = Menu(menu_bar, tearoff=0)
menu_bar.add_cascade(label="Options", menu=submenu)
submenu.add_command(label="Search and Replace", command=find_and_replace)

root.mainloop()

