"""
TreeView with Rollover Effects

Create a two column treeview widget in Python's tkinter library.  The two 
columns should be populated with the key, value pairs of a dictionary 
instantiated at the top of the file.  Style the treeview so that the rows 
backgrounds alternate between white and light grey.  When a user selects one 
of the rows, set that row's background to a light blue.  When a mouse hovers 
over a row, change that row's background a darker grey.
"""


# Refactored create_directory_frame funtion into smaller functions
 

import tkinter as tk
from tkinter import ttk

# Example dictionary
regex_code = {
    "Item 1": "https://example.com/1",
    "Item 2": "https://example.com/2",
    "Item 3": "https://example.com/3",
    "Item 4": "https://example.com/4",
}

def on_double_click(event):
    # Get the clicked row's "Item" text and insert it into the text input
    item_id = event.widget.focus()
    item = event.widget.item(item_id)
    item_text = item["text"]  # Get the text from the first column ("Item")
    if item_text:
        regex_entry.delete(0, tk.END)  # Clear the current text
        regex_entry.insert(0, item_text)  # Insert the "Item" text

def create_input_frame(parent):
    # Create a frame to hold the label and text input
    input_frame = ttk.Frame(parent)
    input_frame.grid(row=0, column=0, sticky="ew", padx=5, pady=5)

    # Add a label and entry widget
    label = ttk.Label(input_frame, text="Regular Expression")
    label.grid(row=0, column=0, sticky="w", padx=(0, 5))
    
    global regex_entry
    regex_entry = ttk.Entry(input_frame, width=50)
    regex_entry.grid(row=0, column=1, sticky="ew")

    input_frame.columnconfigure(1, weight=1)  # Make the entry stretchable


# Functions to Create Directory (Treeview Widget) ----------------------------

def create_treeview_style():
    """Configure the Treeview widget's style."""
    style = ttk.Style()
    style.configure("Custom.Treeview", rowheight=25)
    style.map(
        "Custom.Treeview", 
        background=[("selected", "#cce5ff")],  # Highlight color when selected
        foreground=[("selected", "black")],   # Text color when selected
    )
    style.layout(
        "Custom.Treeview", [("Treeview.treearea", {"sticky": "nswe"})]
    )

def setup_treeview(parent):
    """Create and configure the Treeview widget."""
    directory = ttk.Treeview(parent, style="Custom.Treeview")
    directory.pack(fill="both", expand=True)
    directory["columns"] = ("Link",)
    directory.column("#0", width=150, anchor="w")  # The first column
    directory.column("Link", width=300, anchor="w")  # The second column
    directory.heading("#0", text="Item")
    directory.heading("Link", text="Link")
    return directory

def apply_row_styles(treeview):
    """Apply alternating row styles to the Treeview."""
    for i, child in enumerate(treeview.get_children()):
        if i % 2 == 0:
            treeview.tag_configure("evenrow", background="white")
            treeview.item(child, tags=("evenrow",))
        else:
            treeview.tag_configure("oddrow", background="#f2f2f2")
            treeview.item(child, tags=("oddrow",))

def configure_hover_effects(treeview, apply_row_styles):
    """Add hover effects to the Treeview."""
    def on_mouse_over(event):
        item_id = treeview.identify_row(event.y)
        for child in treeview.get_children():
            treeview.item(child, tags=())

            # Most important line of code in this function:
            apply_row_styles(treeview) # REQUIRED to keep alternating styles visible during rollover effects
            
        if item_id:
            treeview.tag_configure("hover", background="#d9d9d9")
            treeview.item(item_id, tags=("hover",))
    
    def on_mouse_leave(event):
        for child in treeview.get_children():
            treeview.item(child, tags=())
        apply_row_styles(treeview)

    treeview.bind("<Motion>", on_mouse_over)
    treeview.bind("<Leave>", on_mouse_leave)

def populate_treeview(treeview, data):
    """Populate the Treeview with data from a dictionary."""
    for key, value in data.items():
        treeview.insert("", "end", text=key, values=[value])

# Ensure that the alternating row styles are visible from launch
def create_directory_frame(parent):
    """Main function to set up the directory frame."""
    directory_frame = ttk.Frame(parent)
    directory_frame.grid(row=1, column=0, sticky="nsew", padx=5, pady=(0, 5))

    # Create and configure the Treeview
    create_treeview_style()
    directory = setup_treeview(directory_frame)

    # Populate the Treeview
    populate_treeview(directory, regex_code)

    # Apply alternating row styles initially
    apply_row_styles(directory)  # Critical call to ensure styles appear at startup

    # Configure hover effects
    configure_hover_effects(directory, apply_row_styles)

    # Bind double-click event
    directory.bind("<Double-Button-1>", on_double_click)

'''
def create_directory_frame(parent):
    """Main function to set up the directory frame."""
    directory_frame = ttk.Frame(parent)
    directory_frame.grid(row=1, column=0, sticky="nsew", padx=5, pady=(0, 5))

    # Create and configure the Treeview
    create_treeview_style()
    directory = setup_treeview(directory_frame)

    # Apply styles and configure behavior
    apply_row_styles(directory)
    configure_hover_effects(directory, apply_row_styles)

    # Populate the Treeview
    populate_treeview(directory, regex_code)

    # Bind double-click event
    directory.bind("<Double-Button-1>", on_double_click)
'''

# /Functions to Create Directory (Treeview Widget) ----------------------------


def create_window():
    global window
    window = tk.Tk()
    window.title("Treeview with Text Input")
    window.geometry("600x400")
    window.resizable(True, True)

    # Configure grid
    window.columnconfigure(0, weight=1)
    window.rowconfigure(1, weight=1)

    # Create input frame and directory frame
    create_input_frame(window)
    create_directory_frame(window)

    # Run the application
    window.mainloop()

if __name__ == "__main__":
    create_window()

